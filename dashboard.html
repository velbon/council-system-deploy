<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PPMS - Dashboard</title>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <style>
        .dashboard-header { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); }
        .card { background: white; border-radius: 0.5rem; box-shadow: 0 1px 3px rgba(0,0,0,0.1); padding: 1.5rem; transition: transform 0.2s, box-shadow 0.2s; }
        .card:hover { transform: translateY(-2px); box-shadow: 0 4px 12px rgba(0,0,0,0.15); }
        .module-card { cursor: pointer; border: 2px solid transparent; }
        .module-card:hover { border-color: #3b82f6; }
        .badge { padding: 0.25rem 0.75rem; border-radius: 9999px; font-size: 0.75rem; font-weight: 500; }
        .badge-blue { background: #dbeafe; color: #1e40af; }
        .badge-green { background: #d1fae5; color: #065f46; }
        .badge-yellow { background: #fef3c7; color: #92400e; }
        .badge-red { background: #fee2e2; color: #991b1b; }
        .badge-purple { background: #e9d5ff; color: #7c3aed; }
        .alert-info { background: #dbeafe; color: #1e40af; padding: 1rem; border-radius: 0.5rem; border-left: 4px solid #3b82f6; margin: 1rem 0; }
        .stats-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1.5rem; }
        .modules-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 1.5rem; }
    </style>
</head>
<body class="bg-gray-50">
    <div id="root">
        <div style="text-align: center; padding: 3rem; color: #6b7280;">
            🔄 Loading PPMS Dashboard...
        </div>
    </div>

    <script type="text/babel">
        const { useState, useEffect } = React;

        const Dashboard = () => {
            const [currentUser, setCurrentUser] = useState(null);
            const [currentTime, setCurrentTime] = useState(new Date());

            // Check authentication and set user
            useEffect(() => {
                const user = JSON.parse(localStorage.getItem('ppms_user') || '{}');
                if (!user.id) {
                    window.location.href = 'login.html';
                    return;
                }
                setCurrentUser(user);
            }, []);

            // Update time every minute
            useEffect(() => {
                const timer = setInterval(() => {
                    setCurrentTime(new Date());
                }, 60000);
                return () => clearInterval(timer);
            }, []);

            // Demo statistics
            const stats = {
                totalProjects: 12,
                activeProjects: 8,
                totalCouncils: 5,
                totalBudget: 'SLL 47.5B',
                pendingValidations: 3,
                completedMilestones: 24
            };

            // Available modules based on user role
            const getAvailableModules = () => {
                const baseModules = [
                    {
                        name: 'User Management',
                        description: 'Manage system users and roles',
                        icon: '👥',
                        link: 'admin-enhanced.html',
                        color: 'blue',
                        roles: ['admin']
                    },
                    {
                        name: 'Council Management',
                        description: 'Manage city and district councils',
                        icon: '🏛️',
                        link: 'admin-councils.html',
                        color: 'purple',
                        roles: ['admin']
                    },
                    {
                        name: 'Project Management',
                        description: 'Create and track public projects',
                        icon: '📊',
                        link: 'admin-projects.html',
                        color: 'green',
                        roles: ['admin', 'council_user']
                    },
                    {
                        name: 'Reports & Analytics',
                        description: 'Generate reports and view analytics',
                        icon: '📈',
                        link: 'reports.html',
                        color: 'yellow',
                        roles: ['admin', 'supervisor', 'auditor']
                    },
                    {
                        name: 'Notifications',
                        description: 'System notifications and alerts',
                        icon: '🔔',
                        link: 'notifications.html',
                        color: 'red',
                        roles: ['admin', 'council_user', 'supervisor', 'auditor']
                    },
                    {
                        name: 'Council Dashboard',
                        description: 'Council-specific project view',
                        icon: '🏢',
                        link: 'council-user.html',
                        color: 'blue',
                        roles: ['council_user']
                    },
                    {
                        name: 'Supervisor Dashboard',
                        description: 'Project validation and oversight',
                        icon: '✅',
                        link: 'supervisor.html',
                        color: 'purple',
                        roles: ['supervisor']
                    },
                    {
                        name: 'Auditor Dashboard',
                        description: 'Audit trails and compliance',
                        icon: '📋',
                        link: 'auditor.html',
                        color: 'green',
                        roles: ['auditor']
                    }
                ];

                return baseModules.filter(module => 
                    module.roles.includes(currentUser?.role)
                );
            };

            const navigateToModule = (link) => {
                window.location.href = link;
            };

            const formatTime = (date) => {
                return date.toLocaleString('en-US', {
                    weekday: 'long',
                    year: 'numeric',
                    month: 'long',
                    day: 'numeric',
                    hour: '2-digit',
                    minute: '2-digit'
                });
            };

            const getRoleDisplayName = (role) => {
                switch (role) {
                    case 'admin': return 'System Administrator';
                    case 'council_user': return 'Council User';
                    case 'supervisor': return 'Project Supervisor';
                    case 'auditor': return 'System Auditor';
                    default: return 'User';
                }
            };

            const getBadgeClass = (color) => {
                switch (color) {
                    case 'blue': return 'badge-blue';
                    case 'green': return 'badge-green';
                    case 'yellow': return 'badge-yellow';
                    case 'red': return 'badge-red';
                    case 'purple': return 'badge-purple';
                    default: return 'badge-blue';
                }
            };

            if (!currentUser) {
                return (
                    <div style={{textAlign: 'center', padding: '3rem', color: '#6b7280'}}>
                        🔄 Loading Dashboard...
                    </div>
                );
            }

            const availableModules = getAvailableModules();

            return (
                <div className="min-h-screen bg-gray-50">
                    {/* Header */}
                    <header className="dashboard-header text-white p-6">
                        <div className="max-w-7xl mx-auto">
                            <div className="flex justify-between items-center mb-4">
                                <div>
                                    <h1 className="text-3xl font-bold">🏛️ PPMS Dashboard</h1>
                                    <p className="text-blue-100 mt-2">Public Project Management System</p>
                                </div>
                                <div className="text-right">
                                    <div className="text-lg font-medium">
                                        Welcome, {currentUser.name || currentUser.email}
                                    </div>
                                    <div className="text-sm text-blue-200">
                                        {getRoleDisplayName(currentUser.role)}
                                    </div>
                                    <button
                                        onClick={() => {
                                            localStorage.removeItem('ppms_user');
                                            window.location.href = 'login.html';
                                        }}
                                        className="mt-2 bg-red-600 hover:bg-red-700 px-3 py-1 rounded text-sm font-medium transition-colors"
                                    >
                                        🚪 Logout
                                    </button>
                                </div>
                            </div>
                            
                            <div className="text-blue-100 text-sm">
                                {formatTime(currentTime)}
                            </div>
                        </div>
                    </header>

                    <div className="max-w-7xl mx-auto p-6">
                        {/* Demo Mode Alert */}
                        <div className="alert-info mb-6">
                            <div className="flex items-center">
                                <span className="text-2xl mr-3">💡</span>
                                <div>
                                    <strong>Demo Mode Active</strong> - You're using the PPMS demonstration system with sample data. 
                                    All changes are temporary and stored locally in your browser.
                                </div>
                            </div>
                        </div>

                        {/* Statistics Overview */}
                        <div className="mb-8">
                            <h2 className="text-2xl font-bold text-gray-900 mb-4">System Overview</h2>
                            <div className="stats-grid">
                                <div className="card">
                                    <div className="text-2xl font-bold text-blue-600">{stats.totalProjects}</div>
                                    <div className="text-gray-600">Total Projects</div>
                                </div>
                                <div className="card">
                                    <div className="text-2xl font-bold text-green-600">{stats.activeProjects}</div>
                                    <div className="text-gray-600">Active Projects</div>
                                </div>
                                <div className="card">
                                    <div className="text-2xl font-bold text-purple-600">{stats.totalCouncils}</div>
                                    <div className="text-gray-600">Total Councils</div>
                                </div>
                                <div className="card">
                                    <div className="text-2xl font-bold text-orange-600">{stats.totalBudget}</div>
                                    <div className="text-gray-600">Total Budget</div>
                                    <div className="text-xs text-gray-500">≈ $2.4M USD</div>
                                </div>
                                <div className="card">
                                    <div className="text-2xl font-bold text-red-600">{stats.pendingValidations}</div>
                                    <div className="text-gray-600">Pending Validations</div>
                                </div>
                                <div className="card">
                                    <div className="text-2xl font-bold text-indigo-600">{stats.completedMilestones}</div>
                                    <div className="text-gray-600">Completed Milestones</div>
                                </div>
                            </div>
                        </div>

                        {/* Available Modules */}
                        <div>
                            <h2 className="text-2xl font-bold text-gray-900 mb-4">Available Modules</h2>
                            <div className="modules-grid">
                                {availableModules.map(module => (
                                    <div
                                        key={module.name}
                                        className="card module-card"
                                        onClick={() => navigateToModule(module.link)}
                                    >
                                        <div className="flex items-center justify-between mb-3">
                                            <div className="text-3xl">{module.icon}</div>
                                            <span className={`badge ${getBadgeClass(module.color)}`}>
                                                {module.roles.join(', ')}
                                            </span>
                                        </div>
                                        <h3 className="text-lg font-semibold text-gray-900 mb-2">
                                            {module.name}
                                        </h3>
                                        <p className="text-gray-600 text-sm mb-4">
                                            {module.description}
                                        </p>
                                        <div className="flex justify-end">
                                            <span className="text-blue-600 text-sm font-medium">
                                                Open Module →
                                            </span>
                                        </div>
                                    </div>
                                ))}
                            </div>
                        </div>

                        {/* Quick Actions */}
                        <div className="mt-8">
                            <h2 className="text-2xl font-bold text-gray-900 mb-4">Quick Actions</h2>
                            <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4">
                                <button
                                    onClick={() => window.location.href = 'dashboard-enhanced.html'}
                                    className="card module-card text-left bg-gradient-to-r from-blue-500 to-purple-600 text-white border-0"
                                >
                                    <div className="text-xl mb-2">📊</div>
                                    <div className="font-medium">Enhanced Dashboard</div>
                                    <div className="text-sm text-blue-100">KPIs, Charts & Maps</div>
                                </button>
                                {currentUser.role === 'admin' && (
                                    <>
                                        <button
                                            onClick={() => window.location.href = 'admin-enhanced.html'}
                                            className="card module-card text-left"
                                        >
                                            <div className="text-xl mb-2">👤</div>
                                            <div className="font-medium">Create User</div>
                                            <div className="text-sm text-gray-600">Add new system user</div>
                                        </button>
                                        <button
                                            onClick={() => window.location.href = 'admin-councils.html'}
                                            className="card module-card text-left"
                                        >
                                            <div className="text-xl mb-2">🏛️</div>
                                            <div className="font-medium">Add Council</div>
                                            <div className="text-sm text-gray-600">Register new council</div>
                                        </button>
                                    </>
                                )}
                                {(currentUser.role === 'admin' || currentUser.role === 'council_user') && (
                                    <button
                                        onClick={() => window.location.href = 'admin-projects.html'}
                                        className="card module-card text-left"
                                    >
                                        <div className="text-xl mb-2">📊</div>
                                        <div className="font-medium">New Project</div>
                                        <div className="text-sm text-gray-600">Create project</div>
                                    </button>
                                )}
                                <button
                                    onClick={() => window.location.href = 'reports.html'}
                                    className="card module-card text-left"
                                >
                                    <div className="text-xl mb-2">📈</div>
                                    <div className="font-medium">View Reports</div>
                                    <div className="text-sm text-gray-600">Generate analytics</div>
                                </button>
                            </div>
                        </div>

                        {/* Footer */}
                        <footer className="mt-12 text-center text-gray-500 text-sm">
                            <div className="border-t border-gray-200 pt-6">
                                PPMS Demo v1.0 • Sierra Leone Public Project Management System
                                <br />
                                Demo Mode - All data is simulated for demonstration purposes
                            </div>
                        </footer>
                    </div>
                </div>
            );
        };

        // Render the app
        ReactDOM.render(<Dashboard />, document.getElementById('root'));
    </script>
</body>
</html>
