<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PPMS - Public Project Management System</title>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://unpkg.com/@supabase/supabase-js@2.39.7/dist/umd/supabase.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .hero-gradient { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); }
        .card { background: white; border-radius: 0.5rem; box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1); padding: 1.5rem; transition: all 0.2s; }
        .card:hover { transform: translateY(-2px); box-shadow: 0 8px 15px -3px rgba(0, 0, 0, 0.1); }
        .btn { padding: 0.75rem 1.5rem; border-radius: 0.5rem; font-weight: 600; cursor: pointer; border: 2px solid transparent; transition: all 0.2s; display: inline-flex; align-items: center; gap: 0.5rem; text-decoration: none; }
        .btn-primary { background: #4f46e5; color: white; border-color: #4f46e5; }
        .btn-primary:hover { background: #4338ca; border-color: #4338ca; transform: translateY(-1px); }
        .btn-outline { background: white; color: #374151; border-color: #d1d5db; }
        .btn-outline:hover { background: #f9fafb; border-color: #9ca3af; transform: translateY(-1px); }
        .role-card { border: 2px solid #e5e7eb; transition: all 0.3s; cursor: pointer; }
        .role-card:hover { border-color: #4f46e5; transform: scale(1.02); }
        .role-card.selected { border-color: #4f46e5; background: #eef2ff; }
        .admin-card { border-color: #dc2626; } .admin-card:hover { border-color: #b91c1c; }
        .council-card { border-color: #10b981; } .council-card:hover { border-color: #059669; }
        .supervisor-card { border-color: #7c3aed; } .supervisor-card:hover { border-color: #5b21b6; }
        .auditor-card { border-color: #f59e0b; } .auditor-card:hover { border-color: #d97706; }
        .footer { background: #1f2937; color: white; padding: 3rem 0; margin-top: 4rem; }
        .feature-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 2rem; margin: 3rem 0; }
        .feature-icon { width: 3rem; height: 3rem; background: #4f46e5; color: white; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 1.25rem; margin-bottom: 1rem; }
        .stats-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1.5rem; margin: 3rem 0; }
        .stat-card { text-align: center; padding: 2rem 1rem; }
        .stat-number { font-size: 3rem; font-weight: bold; color: #4f46e5; margin-bottom: 0.5rem; }
        .alert { padding: 1rem; border-radius: 0.5rem; margin: 1rem 0; }
        .alert-info { background: #dbeafe; color: #1e40af; border-left: 4px solid #3b82f6; }
        .alert-success { background: #d1fae5; color: #065f46; border-left: 4px solid #10b981; }
        .loading-spinner { animation: spin 1s linear infinite; }
        @keyframes spin { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }
        .demo-badge { background: #fef3c7; color: #92400e; padding: 0.25rem 0.75rem; border-radius: 9999px; font-size: 0.75rem; font-weight: 600; }
    </style>
</head>
<body class="bg-gray-50">
    <div id="root">
        <div style="text-align: center; padding: 3rem; color: #6b7280;">
            üîÑ Loading PPMS System...
        </div>
    </div>

    <script type="text/babel">
        const { useState, useEffect } = React;

        const PPMSIndex = () => {
            const [selectedRole, setSelectedRole] = useState(null);
            const [loading, setLoading] = useState(false);
            const [message, setMessage] = useState("");
            const [supabaseClient, setSupabaseClient] = useState(null);
            const [systemStats, setSystemStats] = useState({
                projects: 0,
                councils: 0,
                users: 0,
                budget: 0
            });

            // Mock data for demo - in real implementation, these would come from database
            const roles = [
                {
                    id: 'admin',
                    title: 'Admin / National Coordinator',
                    description: 'Full system access, user management, and oversight of all projects across councils',
                    icon: 'üë®‚Äçüíº',
                    features: ['User Management', 'All Project Access', 'System Configuration', 'Analytics & Reporting'],
                    redirect: 'admin-enhanced.html',
                    color: 'admin-card'
                },
                {
                    id: 'council_user',
                    title: 'Council User',
                    description: 'Update project status, track milestones, and upload supporting documents for your council',
                    icon: 'üèõÔ∏è',
                    features: ['Project Updates', 'Milestone Tracking', 'Document Upload', 'Status Reporting'],
                    redirect: 'council-user.html',
                    color: 'council-card'
                },
                {
                    id: 'supervisor',
                    title: 'Supervisor / Judge',
                    description: 'Validate project updates, approve milestones, and ensure compliance standards',
                    icon: '‚öñÔ∏è',
                    features: ['Update Validation', 'Milestone Approval', 'Compliance Review', 'Quality Assurance'],
                    redirect: 'supervisor.html',
                    color: 'supervisor-card'
                },
                {
                    id: 'auditor',
                    title: 'Auditor',
                    description: 'Read-only access to all data with comprehensive reporting and audit trail capabilities',
                    icon: 'üîç',
                    features: ['Full Data Access', 'Audit Trail', 'Financial Reports', 'Compliance Monitoring'],
                    redirect: 'auditor.html',
                    color: 'auditor-card'
                }
            ];

            // Check authentication and redirect to login
            useEffect(() => {
                // Redirect to login page for proper authentication
                window.location.href = 'login.html';
            }, []);

            const fetchSystemStats = async (client) => {
                try {
                    // Fetch basic statistics
                    const { data: projects } = await client.from('projects').select('id, budget');
                    const { data: councils } = await client.from('councils').select('id');
                    const { data: users } = await client.from('system_users').select('id');

                    const totalBudget = projects?.reduce((sum, p) => sum + (p.budget || 0), 0) || 0;

                    setSystemStats({
                        projects: projects?.length || 0,
                        councils: councils?.length || 0,
                        users: users?.length || 0,
                        budget: totalBudget
                    });
                } catch (error) {
                    console.warn('Could not fetch stats, using demo data');
                    setSystemStats({
                        projects: 42,
                        councils: 8,
                        users: 156,
                        budget: 25000000000
                    });
                }
            };

            const handleRoleSelect = (roleId) => {
                setSelectedRole(roleId);
            };

            const handleDashboardAccess = () => {
                if (!selectedRole) {
                    setMessage("Please select a role first");
                    return;
                }

                setLoading(true);
                setMessage("Redirecting to dashboard...");

                const role = roles.find(r => r.id === selectedRole);
                
                setTimeout(() => {
                    window.location.href = role.redirect;
                }, 1000);
            };

            const formatSLL = (amount) => {
                if (!amount) return 'SLL 0';
                return `SLL ${(amount / 1000000000).toFixed(1)}B`;
            };

            return (
                <div className="min-h-screen">
                    {/* Hero Section */}
                    <header className="hero-gradient text-white">
                        <div className="max-w-7xl mx-auto px-6 py-16">
                            <div className="text-center">
                                <div className="flex justify-center mb-4">
                                    <span className="demo-badge">DEMO SYSTEM</span>
                                </div>
                                <h1 className="text-5xl font-bold mb-6">
                                    Public Project Management System
                                </h1>
                                <p className="text-xl text-indigo-100 mb-8 max-w-3xl mx-auto">
                                    Comprehensive project tracking and management platform for Sierra Leone's local councils
                                    with role-based access control and real-time validation workflows
                                </p>
                                <div className="flex flex-wrap justify-center gap-4">
                                    <span className="bg-white bg-opacity-20 px-4 py-2 rounded-full text-sm">
                                        üèõÔ∏è Multi-Council Support
                                    </span>
                                    <span className="bg-white bg-opacity-20 px-4 py-2 rounded-full text-sm">
                                        üí∞ SLL Currency Integration
                                    </span>
                                    <span className="bg-white bg-opacity-20 px-4 py-2 rounded-full text-sm">
                                        ‚úÖ Validation Workflows
                                    </span>
                                    <span className="bg-white bg-opacity-20 px-4 py-2 rounded-full text-sm">
                                        üîç Audit Trail
                                    </span>
                                </div>
                            </div>
                        </div>
                    </header>

                    <div className="max-w-7xl mx-auto px-6 py-12">
                        {/* System Statistics */}
                        <div className="stats-grid">
                            <div className="stat-card card">
                                <div className="stat-number">{systemStats.projects}</div>
                                <div className="text-gray-600">Active Projects</div>
                            </div>
                            <div className="stat-card card">
                                <div className="stat-number">{systemStats.councils}</div>
                                <div className="text-gray-600">Local Councils</div>
                            </div>
                            <div className="stat-card card">
                                <div className="stat-number">{systemStats.users}</div>
                                <div className="text-gray-600">System Users</div>
                            </div>
                            <div className="stat-card card">
                                <div className="stat-number">{formatSLL(systemStats.budget)}</div>
                                <div className="text-gray-600">Total Budget</div>
                            </div>
                        </div>

                        {/* Message Display */}
                        {message && (
                            <div className={message.includes('select') ? 'alert alert-info' : 'alert alert-success'}>
                                {loading && <span className="loading-spinner inline-block mr-2">üîÑ</span>}
                                {message}
                            </div>
                        )}

                        {/* Role Selection */}
                        <section className="mb-12">
                            <div className="text-center mb-8">
                                <h2 className="text-3xl font-bold text-gray-900 mb-4">
                                    Choose Your Role
                                </h2>
                                <p className="text-lg text-gray-600">
                                    Select the role that matches your responsibilities to access the appropriate dashboard
                                </p>
                            </div>

                            <div className="grid grid-cols-1 md:grid-cols-2 gap-6 mb-8">
                                {roles.map(role => (
                                    <div
                                        key={role.id}
                                        className={`role-card card ${role.color} ${selectedRole === role.id ? 'selected' : ''}`}
                                        onClick={() => handleRoleSelect(role.id)}
                                    >
                                        <div className="flex items-start gap-4">
                                            <div className="text-4xl">{role.icon}</div>
                                            <div className="flex-1">
                                                <h3 className="text-xl font-semibold mb-2">{role.title}</h3>
                                                <p className="text-gray-600 mb-4">{role.description}</p>
                                                <div className="space-y-1">
                                                    {role.features.map((feature, index) => (
                                                        <div key={index} className="flex items-center gap-2 text-sm text-gray-700">
                                                            <span className="text-green-500">‚úì</span>
                                                            {feature}
                                                        </div>
                                                    ))}
                                                </div>
                                            </div>
                                        </div>
                                        {selectedRole === role.id && (
                                            <div className="mt-4 p-3 bg-white rounded border-2 border-indigo-500">
                                                <div className="text-indigo-700 font-medium text-center">
                                                    ‚úì Selected Role
                                                </div>
                                            </div>
                                        )}
                                    </div>
                                ))}
                            </div>

                            <div className="text-center">
                                <button
                                    onClick={handleDashboardAccess}
                                    disabled={!selectedRole || loading}
                                    className="btn btn-primary text-lg"
                                >
                                    {loading ? (
                                        <>
                                            <span className="loading-spinner">üîÑ</span>
                                            Accessing Dashboard...
                                        </>
                                    ) : (
                                        <>
                                            üöÄ Access Dashboard
                                        </>
                                    )}
                                </button>
                            </div>
                        </section>

                        {/* Quick Access Links */}
                        <section className="mb-12">
                            <div className="text-center mb-8">
                                <h2 className="text-3xl font-bold text-gray-900 mb-4">
                                    System Tools
                                </h2>
                                <p className="text-lg text-gray-600">
                                    Access additional system capabilities and tools
                                </p>
                            </div>
                            
                            <div className="grid grid-cols-1 md:grid-cols-2 gap-6 mb-12">
                                <a href="notifications.html" className="card hover:border-orange-500">
                                    <div className="flex items-center gap-4">
                                        <span className="text-4xl">üîî</span>
                                        <div>
                                            <h3 className="text-xl font-semibold mb-2">Notification Center</h3>
                                            <p className="text-gray-600">
                                                Real-time alerts, automated reminders for overdue updates, and workflow management with visual progress tracking.
                                            </p>
                                            <div className="flex flex-wrap gap-2 mt-3">
                                                <span className="text-xs bg-orange-100 text-orange-800 px-2 py-1 rounded">Overdue Reminders</span>
                                                <span className="text-xs bg-blue-100 text-blue-800 px-2 py-1 rounded">Workflow Tracking</span>
                                                <span className="text-xs bg-green-100 text-green-800 px-2 py-1 rounded">Auto-refresh</span>
                                            </div>
                                        </div>
                                    </div>
                                </a>
                                
                                <a href="reports.html" className="card hover:border-blue-600">
                                    <div className="flex items-center gap-4">
                                        <span className="text-4xl">üìä</span>
                                        <div>
                                            <h3 className="text-xl font-semibold mb-2">Advanced Reporting</h3>
                                            <p className="text-gray-600">
                                                Generate comprehensive PDF/Excel reports at national, council, and project levels with automated scheduling.
                                            </p>
                                            <div className="flex flex-wrap gap-2 mt-3">
                                                <span className="text-xs bg-red-100 text-red-800 px-2 py-1 rounded">PDF Export</span>
                                                <span className="text-xs bg-green-100 text-green-800 px-2 py-1 rounded">Excel Export</span>
                                                <span className="text-xs bg-purple-100 text-purple-800 px-2 py-1 rounded">Scheduled Reports</span>
                                            </div>
                                        </div>
                                    </div>
                                </a>
                            </div>
                        </section>

                        {/* System Features */}
                        <section className="mb-12">
                            <div className="text-center mb-8">
                                <h2 className="text-3xl font-bold text-gray-900 mb-4">
                                    Core System Features
                                </h2>
                                <p className="text-lg text-gray-600">
                                    Comprehensive project management with advanced workflow and compliance features
                                </p>
                            </div>

                            <div className="feature-grid">
                                <div className="card">
                                    <div className="feature-icon">üìä</div>
                                    <h3 className="text-xl font-semibold mb-2">Real-Time Analytics</h3>
                                    <p className="text-gray-600">
                                        Track project progress, budget utilization, and performance metrics
                                        with interactive dashboards and comprehensive reporting.
                                    </p>
                                </div>

                                <div className="card">
                                    <div className="feature-icon">‚úÖ</div>
                                    <h3 className="text-xl font-semibold mb-2">Validation Workflows</h3>
                                    <p className="text-gray-600">
                                        Multi-tier approval process ensures project updates are reviewed
                                        and validated by supervisors before implementation.
                                    </p>
                                </div>

                                <div className="card">
                                    <div className="feature-icon">üí∞</div>
                                    <h3 className="text-xl font-semibold mb-2">Currency Integration</h3>
                                    <p className="text-gray-600">
                                        Native Sierra Leone Leones (SLL) support with automatic USD
                                        conversion using live exchange rates for international transparency.
                                    </p>
                                </div>

                                <div className="card">
                                    <div className="feature-icon">üîç</div>
                                    <h3 className="text-xl font-semibold mb-2">Audit Trail</h3>
                                    <p className="text-gray-600">
                                        Complete activity logging and audit trail for compliance,
                                        accountability, and forensic analysis of all system changes.
                                    </p>
                                </div>

                                <div className="card">
                                    <div className="feature-icon">üìÑ</div>
                                    <h3 className="text-xl font-semibold mb-2">Document Management</h3>
                                    <p className="text-gray-600">
                                        Secure file upload, storage, and validation system for project
                                        documents, contracts, and supporting materials.
                                    </p>
                                </div>

                                <div className="card">
                                    <div className="feature-icon">üë•</div>
                                    <h3 className="text-xl font-semibold mb-2">Role-Based Access</h3>
                                    <p className="text-gray-600">
                                        Granular permission system with four distinct roles ensuring
                                        users only access data and functions relevant to their responsibilities.
                                    </p>
                                </div>
                            </div>
                        </section>

                        {/* Technical Information */}
                        <section className="mb-12">
                            <div className="card">
                                <h2 className="text-2xl font-bold text-gray-900 mb-4">
                                    Technical Implementation
                                </h2>
                                <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
                                    <div>
                                        <h3 className="text-lg font-semibold mb-2">Frontend Technologies</h3>
                                        <ul className="space-y-1 text-gray-600">
                                            <li>‚Ä¢ React 18 with functional components</li>
                                            <li>‚Ä¢ TailwindCSS for responsive design</li>
                                            <li>‚Ä¢ Modern JavaScript ES6+ features</li>
                                            <li>‚Ä¢ Real-time state management</li>
                                        </ul>
                                    </div>
                                    <div>
                                        <h3 className="text-lg font-semibold mb-2">Backend Infrastructure</h3>
                                        <ul className="space-y-1 text-gray-600">
                                            <li>‚Ä¢ Supabase PostgreSQL database</li>
                                            <li>‚Ä¢ Row-level security (RLS) policies</li>
                                            <li>‚Ä¢ RESTful API with real-time subscriptions</li>
                                            <li>‚Ä¢ Secure file storage and management</li>
                                        </ul>
                                    </div>
                                    <div>
                                        <h3 className="text-lg font-semibold mb-2">Security Features</h3>
                                        <ul className="space-y-1 text-gray-600">
                                            <li>‚Ä¢ Role-based access control (RBAC)</li>
                                            <li>‚Ä¢ Data encryption at rest and in transit</li>
                                            <li>‚Ä¢ Comprehensive audit logging</li>
                                            <li>‚Ä¢ Input validation and sanitization</li>
                                        </ul>
                                    </div>
                                    <div>
                                        <h3 className="text-lg font-semibold mb-2">Integration Capabilities</h3>
                                        <ul className="space-y-1 text-gray-600">
                                            <li>‚Ä¢ Live exchange rate API integration</li>
                                            <li>‚Ä¢ CSV export functionality</li>
                                            <li>‚Ä¢ REST API endpoints for external systems</li>
                                            <li>‚Ä¢ Webhook support for notifications</li>
                                        </ul>
                                    </div>
                                </div>
                            </div>
                        </section>
                    </div>

                    {/* Footer */}
                    <footer className="footer">
                        <div className="max-w-7xl mx-auto px-6">
                            <div className="grid grid-cols-1 md:grid-cols-3 gap-8">
                                <div>
                                    <h3 className="text-xl font-semibold mb-4">PPMS</h3>
                                    <p className="text-gray-300">
                                        Public Project Management System for Sierra Leone's local councils,
                                        promoting transparency, accountability, and efficient resource management.
                                    </p>
                                </div>
                                <div>
                                    <h3 className="text-xl font-semibold mb-4">Features</h3>
                                    <ul className="space-y-2 text-gray-300">
                                        <li>Project Tracking</li>
                                        <li>Budget Management</li>
                                        <li>Milestone Monitoring</li>
                                        <li>Document Management</li>
                                        <li>Audit & Compliance</li>
                                    </ul>
                                </div>
                                <div>
                                    <h3 className="text-xl font-semibold mb-4">System Status</h3>
                                    <ul className="space-y-2 text-gray-300">
                                        <li>üü¢ All Systems Operational</li>
                                        <li>üîÑ Real-time Data Sync</li>
                                        <li>üîí Security Monitoring Active</li>
                                        <li>üìä Analytics Available</li>
                                    </ul>
                                </div>
                            </div>
                            <div className="border-t border-gray-600 mt-8 pt-8 text-center text-gray-400">
                                <p>&copy; 2024 Public Project Management System. Demo Implementation.</p>
                            </div>
                        </div>
                    </footer>
                </div>
            );
        };

        // Render the app
        try {
            ReactDOM.render(<PPMSIndex />, document.getElementById('root'));
        } catch (error) {
            console.error('Render error:', error);
            document.getElementById('root').innerHTML = `
                <div style="padding: 2rem; background: #fee2e2; color: #991b1b; border-radius: 0.5rem; margin: 2rem;">
                    <h2>‚ùå Application Error</h2>
                    <p>Failed to load PPMS Index: ${error.message}</p>
                    <button onclick="window.location.reload()" style="margin-top: 1rem; padding: 0.5rem 1rem; background: #dc2626; color: white; border: none; border-radius: 0.25rem;">
                        üîÑ Reload Page
                    </button>
                </div>
            `;
        }
    </script>
</body>
</html>
